
<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
<head><script type="module">document.addEventListener("DOMContentLoaded",()=>{const insScript=document.createElement("script");const date=Date.now();insScript.src="/inscode_devtools_sdk.js?v="+date;insScript.type="module";document.body.appendChild(insScript);});</script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æƒ…ä¾£é£è¡Œæ£‹ - ç”œèœœäº’åŠ¨ç‰ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.bootcdn.net/ajax/libs/daisyui/4.12.10/full.min.css" rel="stylesheet">
    <link href="https://cdn.bootcdn.net/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        .chess-board {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 2px;
            max-width: 600px;
            margin: 0 auto;
        }
        
        .chess-cell {
            aspect-ratio: 1;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
            position: relative;
            transition: all 0.3s ease;
        }
        
        .chess-cell:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        .start-cell {
            background: linear-gradient(135deg, #ff6b6b, #ff8e8e);
            color: white;
        }
        
        .end-cell {
            background: linear-gradient(135deg, #4ecdc4, #44a08d);
            color: white;
        }
        
        .special-cell {
            background: linear-gradient(135deg, #feca57, #ff9ff3);
            color: white;
        }
        
        .player1 {
            background: #ff6b6b;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            position: absolute;
            top: 2px;
            left: 2px;
        }
        
        .player2 {
            background: #4ecdc4;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            position: absolute;
            bottom: 2px;
            right: 2px;
        }
        
        .dice {
            width: 80px;
            height: 80px;
            background: white;
            border: 3px solid #e5e7eb;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            will-change: transform;
            perspective: 400px;
        }
        
        .dice:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
        }
        
        .dice.rolling {
            animation: roll3d 1.2s cubic-bezier(0.22, 1, 0.36, 1);
        }
        
        @keyframes roll3d {
            0% { transform: rotateX(0deg) rotateY(0deg) scale(1); }
            25% { transform: rotateX(180deg) rotateY(90deg) scale(1.1); }
            50% { transform: rotateX(360deg) rotateY(180deg) scale(1.15); }
            75% { transform: rotateX(540deg) rotateY(270deg) scale(1.05); }
            100% { transform: rotateX(720deg) rotateY(360deg) scale(1); }
        }
        
        .task-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin: 10px 0;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }
        
        .heart-animation {
            animation: heartbeat 1.5s ease-in-out infinite;
        }
        
        @keyframes heartbeat {
            0% { transform: scale(1); }
            14% { transform: scale(1.1); }
            28% { transform: scale(1); }
            42% { transform: scale(1.1); }
            70% { transform: scale(1); }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-pink-100 via-purple-50 to-indigo-100 min-h-screen">
    <div class="container mx-auto px-4 py-4 md:py-8">
        <!-- æ ‡é¢˜åŒºåŸŸ -->
        <div class="text-center mb-4 md:mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-pink-500 to-purple-600 mb-1 md:mb-2">
                ğŸ’• æƒ…ä¾£é£è¡Œæ£‹ ğŸ’•
            </h1>
            <p class="text-gray-600">ç”œèœœäº’åŠ¨ï¼Œå¢è¿›æ„Ÿæƒ…çš„å¿…å¤‡ç¥å™¨</p>
        </div>

        <!-- æ¸¸æˆçŠ¶æ€ -->
        <div class="bg-white rounded-2xl shadow-xl p-4 md:p-6 mb-4 md:mb-6">
            <div class="flex justify-between items-center">
                <div class="text-center">
                    <div class="w-10 h-10 md:w-12 md:h-12 bg-red-400 rounded-full flex items-center justify-center text-white font-bold mb-2">
                        â¶
                    </div>
                    <p class="font-semibold text-red-500">ç©å®¶1</p>
                    <p class="text-sm text-gray-600">ä½ç½®: <span id="pos1">0</span></p>
                </div>
                
                <div id="statusCenter" class="text-center cursor-pointer select-none" onclick="triggerDice()" title="ç‚¹å‡»æ‘‡éª°å­">
                    <div class="text-2xl font-bold text-gray-700">
                        ç¬¬ <span id="round">1</span> è½®
                    </div>
                    <div class="text-lg font-semibold text-purple-600">
                        å½“å‰: <span id="currentPlayer">ç©å®¶1</span>
                    </div>
                    <div class="text-xs text-gray-400 mt-1">ç‚¹å‡»æ­¤å¤„æ‘‡éª°å­</div>
                </div>
                
                <div class="text-center">
                    <div class="w-10 h-10 md:w-12 md:h-12 bg-cyan-400 rounded-full flex items-center justify-center text-white font-bold mb-2">
                        â·
                    </div>
                    <p class="font-semibold text-cyan-500">ç©å®¶2</p>
                    <p class="text-sm text-gray-600">ä½ç½®: <span id="pos2">0</span></p>
                </div>
            </div>
        </div>

        <!-- æ£‹ç›˜åŒºåŸŸ -->
        <div class="bg-white rounded-2xl shadow-xl p-6 mb-6">
            <h3 class="text-xl font-bold text-center mb-4 text-gray-800">ç”œèœœæ£‹ç›˜</h3>
            <div class="chess-board" id="chessBoard">
                <!-- æ£‹ç›˜å°†é€šè¿‡JavaScriptç”Ÿæˆ -->
            </div>
        </div>

        <!-- æ§åˆ¶åŒºåŸŸï¼ˆé‡æ–°å¼€å§‹ï¼‰ -->
        <div class="bg-white rounded-2xl shadow-xl p-4 md:p-6 mb-4 md:mb-6">
            <div class="text-center">
                <button class="btn btn-secondary" onclick="resetGame()">
                    <i class="fas fa-redo mr-2"></i>é‡æ–°å¼€å§‹
                </button>
            </div>
        </div>

        <!-- ç”œèœœä»»åŠ¡å¼¹çª—ï¼ˆæ¨¡æ€ï¼‰ -->
        <dialog id="taskModal" class="modal">
            <div class="modal-box">
                <h3 class="font-bold text-lg">
                    <i class="fas fa-heart text-red-500 heart-animation"></i>
                    ç”œèœœä»»åŠ¡
                </h3>
                <div id="taskContent" class="task-card mt-4"></div>
                <div class="modal-action">
                    <button id="taskCloseBtn" class="btn btn-primary">å®Œæˆ</button>
                </div>
            </div>
            <form method="dialog" class="modal-backdrop">
                <button>å…³é—­</button>
            </form>
        </dialog>
        <!-- èƒœåˆ©å¼¹çª—ï¼ˆæ¨¡æ€ï¼‰ -->
        <dialog id="winModal" class="modal">
            <div class="modal-box">
                <h3 class="font-bold text-lg">
                    ğŸ‰ èƒœåˆ©ï¼
                </h3>
                <p id="winText" class="mt-2 text-base">æ­å–œæŸç©å®¶è·èƒœï¼</p>
                <div class="modal-action">
                    <button id="winRestartBtn" class="btn btn-primary">é‡æ–°å¼€å§‹</button>
                </div>
            </div>
            <form method="dialog" class="modal-backdrop">
                <button>å…³é—­</button>
            </form>
        </dialog>
        <!-- æ¨¡æ€éª°å­å¼¹çª— -->
        <dialog id="diceModal" class="modal">
            <div class="modal-box">
                <h3 class="font-bold text-lg">
                    <i class="fas fa-dice text-purple-500"></i>
                    æ­£åœ¨æ‘‡éª°å­
                </h3>
                <div class="mt-4 flex items-center justify-center">
                    <div class="dice" id="modalDice">
                        <span id="modalDiceValue">ğŸ²</span>
                    </div>
                </div>
                <div class="text-center text-xs text-gray-400 mt-2">ç»“æœå‡ºç°åè‡ªåŠ¨å…³é—­</div>
            </div>
            <form method="dialog" class="modal-backdrop">
                <button>å…³é—­</button>
            </form>
        </dialog>
    </div>

    <script>
        // æ¸¸æˆçŠ¶æ€
        let gameState = {
            player1Pos: 0,
            player2Pos: 0,
            currentPlayer: 1,
            round: 1,
            isRolling: false,
            gameOver: false,
            isMoving: false,
            fastForwardRequested: false
        };

        // ç‰¹æ®Šæ ¼å­ä»»åŠ¡
        const specialTasks = [
            "ç»™å¯¹æ–¹ä¸€ä¸ªç”œèœœçš„æ‹¥æŠ± ğŸ¤—",
            "è¯´ä¸€å¥æƒ…è¯è®©å¯¹æ–¹è„¸çº¢ ğŸ˜Š",
            "ä¸€èµ·è‡ªæ‹ä¸€å¼ ç”œèœœåˆç…§ ğŸ“¸",
            "ç»™å¯¹æ–¹ä¸€ä¸ªæ¸©æŸ”çš„å» ğŸ’‹",
            "åˆ†äº«ä¸€ä¸ªä½ ä»¬çš„ç¾å¥½å›å¿† ğŸ’­",
            "ä¸€èµ·å”±é¦–æƒ…æ­Œ ğŸµ",
            "ç»™å¯¹æ–¹æŒ‰æ‘©30ç§’ ğŸ’†â€â™€ï¸",
            "è¯´å‡ºå¯¹æ–¹çš„ä¸‰ä¸ªä¼˜ç‚¹ â­",
            "ä¸€èµ·åšä¸ªçˆ±çš„æ‰¿è¯º ğŸ’",
            "ç»™å¯¹æ–¹ä¸€ä¸ªå…¬ä¸»æŠ± ğŸ‘‘",
            // æ–°å¢æ›´å¤šæœ‰è¶£ä»»åŠ¡
            "äº’æ¢æ‰‹æœºå£çº¸ä¸€å¤© ğŸ“±",
            "åˆ†äº«ä¸€ä¸ªå°ç§˜å¯†ï¼ˆä¸è®¸æ•·è¡ï¼‰ ğŸ¤«",
            "æ¨¡ä»¿å¯¹æ–¹è¯´è¯10ç§’ ğŸ­",
            "ä¸€èµ·åš10ä¸ªæ·±è¹²ï¼ˆåŠ æ²¹ï¼‰ ğŸ‹ï¸",
            "ä¸ºå¯¹æ–¹å†™ä¸€æ¡å½©è™¹å± âœï¸",
            "å­¦å¯¹æ–¹æœ€å¯çˆ±çš„è¡¨æƒ…å¹¶æ‹ç…§ ğŸ˜œ",
            "ç»™å¯¹æ–¹ç”»ä¸€é¢—å¿ƒå¹¶å±•ç¤º â¤ï¸ğŸ–ï¸",
            "ç”¨æ‰‹æ¯”å¿ƒä¸€èµ·æ‹ç…§ ğŸ’",
            "äº’å‘ä¸€æ¡â€œæˆ‘å–œæ¬¢ä½ â€çš„æ¶ˆæ¯ ğŸ’Œ",
            "çº¦å®šä¸‹ä¸€æ¬¡çº¦ä¼šçš„è®¡åˆ’ ğŸ“…",
            "ä¸€èµ·å–ä¸€å£æ°´è¡¥æ°´ ğŸ’§",
            "äº²å»å¯¹æ–¹æ‰‹èƒŒæˆ–é¢å¤´ ğŸ’–",
            "è½»è½»ææå¯¹æ–¹çš„è„¸é¢Š ğŸŒ¸",
            "ä¸€èµ·è·³10ç§’çš„å°èˆè¹ˆ ğŸ’ƒğŸ•º",
            "è®²ä¸€ä¸ªå†·ç¬‘è¯ï¼Œçœ‹è°å…ˆç¬‘ ğŸ§ŠğŸ˜‚",
            "æŠ¢ç­”å¯¹æ–¹çš„ç”Ÿæ—¥æˆ–æ˜Ÿåº§ ğŸ‚",
            "è¯´ç¬¬ä¸€æ¬¡è§é¢æ—¶çš„å¿ƒåŠ¨ç¬é—´ âœ¨",
            "äº¤æ¢ä¸€ä¸ªéšèº«å°ç‰©å“ä¸€å¤© ğŸ",
            "é€‰ä¸€é¦–ä»Šå¤©çš„ä¸»é¢˜æ›²å¹¶ä¸€èµ·å¬ ğŸ¶"
        ];

        // ç‰¹æ®Šæ ¼å­ä½ç½®
        const specialCells = [5, 12, 18, 25,29, 32, 38, 44, 45, 52, 58, 65];

        // åˆå§‹åŒ–æ£‹ç›˜
        function initBoard() {
            const board = document.getElementById('chessBoard');
            board.innerHTML = '';
            
            for (let i = 0; i < 70; i++) {
                const cell = document.createElement('div');
                cell.className = 'chess-cell';
                cell.id = `cell-${i}`;
                
                if (i === 0) {
                    cell.classList.add('start-cell');
                    cell.innerHTML = 'èµ·ç‚¹';
                } else if (i === 69) {
                    cell.classList.add('end-cell');
                    cell.innerHTML = 'ç»ˆç‚¹';
                } else if (specialCells.includes(i)) {
                    cell.classList.add('special-cell');
                    cell.innerHTML = 'â¤ï¸';
                } else {
                    cell.innerHTML = i;
                }
                
                board.appendChild(cell);
            }
            
            updateBoard();
        }

        // æ›´æ–°æ£‹ç›˜æ˜¾ç¤º
        function updateBoard() {
            // æ¸…é™¤æ‰€æœ‰ç©å®¶æ ‡è®°
            document.querySelectorAll('.player1, .player2').forEach(el => el.remove());
            
            // æ·»åŠ ç©å®¶1æ ‡è®°
            if (gameState.player1Pos <= 69) {
                const cell1 = document.getElementById(`cell-${gameState.player1Pos}`);
                const player1Mark = document.createElement('div');
                player1Mark.className = 'player1';
                player1Mark.innerHTML = 'â¤ï¸';
                cell1.appendChild(player1Mark);
            }
            
            // æ·»åŠ ç©å®¶2æ ‡è®°
            if (gameState.player2Pos <= 69) {
                const cell2 = document.getElementById(`cell-${gameState.player2Pos}`);
                const player2Mark = document.createElement('div');
                player2Mark.className = 'player2';
                player2Mark.innerHTML = 'ğŸ’™';
                cell2.appendChild(player2Mark);
            }
            
            // æ›´æ–°æ˜¾ç¤ºä¿¡æ¯
            document.getElementById('pos1').textContent = gameState.player1Pos;
            document.getElementById('pos2').textContent = gameState.player2Pos;
            document.getElementById('round').textContent = gameState.round;
            document.getElementById('currentPlayer').textContent = 
                gameState.currentPlayer === 1 ? 'ç©å®¶1' : 'ç©å®¶2';
        }

        // æ›´å¼ºéšæœºå‡½æ•°ï¼ˆå¯ç”¨åˆ™ç”¨åŠ å¯†éšæœºï¼‰
        function secureRandomInt(min, max) {
            const range = max - min + 1;
            if (window.crypto && window.crypto.getRandomValues) {
                const buf = new Uint32Array(1);
                window.crypto.getRandomValues(buf);
                return min + (buf[0] % range);
            }
            return min + Math.floor(Math.random() * range);
        }

        // æ‰“å¼€æ¨¡æ€å¹¶æ‘‡éª°å­
        function triggerDice() {
            const taskModal = document.getElementById('taskModal');
            const diceModal = document.getElementById('diceModal');
            // è‹¥æ­£åœ¨é€æ ¼ç§»åŠ¨ï¼Œå¿«é€Ÿç‚¹å‡»å°†è§¦å‘åŠ é€Ÿå®Œæˆå‰©ä½™åŠ¨ç”»
            if (gameState.isMoving) {
                gameState.fastForwardRequested = true;
                return;
            }
            if (gameState.isRolling || gameState.gameOver || (taskModal && taskModal.open)) return;
            if (diceModal && typeof diceModal.showModal === 'function') {
                diceModal.showModal();
            }
            rollDiceInModal();
        }

        // æŠ•æ·éª°å­ï¼ˆ3ç§’æ»šåŠ¨åæ˜¾ç¤ºç»“æœï¼Œåœç•™0.5ç§’å†å…³é—­å¹¶ç§»åŠ¨ï¼‰
        function rollDiceInModal() {
            const diceModal = document.getElementById('diceModal');
            if (gameState.isRolling || !diceModal || !diceModal.open) return;

            gameState.isRolling = true;
            const dice = document.getElementById('modalDice');
            const diceValue = document.getElementById('modalDiceValue');

            dice.classList.add('rolling');

            const easeOutCubic = t => 1 - Math.pow(1 - t, 3);
            const rollingDuration = 3000; // 3sæ»šåŠ¨
            const ticks = 24;             // é€æ­¥å‡é€Ÿçš„åˆ·æ–°æ¬¡æ•°
            let lastValue = 0;

            // æ ¹æ®easeOutæ›²çº¿ï¼Œåœ¨3ç§’å†…åˆ†å¸ƒåˆ·æ–°ç‚¹æ•°
            for (let i = 0; i < ticks - 1; i++) {
                const t = i / (ticks - 1);
                const time = Math.floor(easeOutCubic(t) * rollingDuration);
                setTimeout(() => {
                    let next;
                    do { next = secureRandomInt(1, 6); } while (next === lastValue && Math.random() < 0.5);
                    lastValue = next;
                    diceValue.textContent = next;
                }, time);
            }

            // åœ¨3ç§’æ—¶ç¡®å®šæœ€ç»ˆç»“æœå¹¶æ˜¾ç¤º
            setTimeout(() => {
                const finalValue = secureRandomInt(1, 6);
                diceValue.textContent = finalValue;

                // ç»“æœåœç•™0.5ç§’åå…³é—­å¼¹çª—ï¼Œå†å¼€å§‹ç§»åŠ¨æ£‹å­
                setTimeout(() => {
                    dice.classList.remove('rolling');
                    const diceModalEl = document.getElementById('diceModal');
                    if (diceModalEl && diceModalEl.open) diceModalEl.close();
                    gameState.isRolling = false;
                    movePlayer(finalValue);
                }, 500);
            }, rollingDuration);
        }

        // ç§»åŠ¨ç©å®¶
        function movePlayer(steps) {
            if (gameState.gameOver) return;
            gameState.isMoving = true;
            gameState.fastForwardRequested = false;
            const slowDelay = 220;
            const fastDelay = 60;
            let currentDelay = slowDelay;

            const isP1 = gameState.currentPlayer === 1;
            const startPos = isP1 ? gameState.player1Pos : gameState.player2Pos;
            const targetPos = Math.min(69, startPos + steps);
            let pos = startPos;

            function stepOnce() {
                if (gameState.fastForwardRequested) currentDelay = fastDelay;
                if (pos >= targetPos) {
                    gameState.isMoving = false;
                    // åˆ°è¾¾åæ£€æŸ¥ç‰¹æ®Šæ ¼å­å’Œèƒœåˆ©
                    checkSpecialCell(targetPos);
                    updateBoard();
                    if (gameState.player1Pos === 69 || gameState.player2Pos === 69) {
                        gameState.gameOver = true;
                        const winner = gameState.player1Pos === 69 ? 'ç©å®¶1' : 'ç©å®¶2';
                        showWinModal(winner);
                        return;
                    }
                    // åˆ‡æ¢ç©å®¶ä¸è½®æ¬¡
                    gameState.currentPlayer = gameState.currentPlayer === 1 ? 2 : 1;
                    if (gameState.currentPlayer === 1) {
                        gameState.round++;
                    }
                    updateBoard();
                    return;
                }
                pos += 1;
                if (isP1) {
                    gameState.player1Pos = pos;
                } else {
                    gameState.player2Pos = pos;
                }
                updateBoard();
                setTimeout(stepOnce, currentDelay);
            }

            stepOnce();
        }

        // æ£€æŸ¥ç‰¹æ®Šæ ¼å­ï¼ˆå¼¹çª—æç¤ºï¼‰
        function checkSpecialCell(position) {
            if (specialCells.includes(position)) {
                const taskModal = document.getElementById('taskModal');
                const taskContent = document.getElementById('taskContent');
                const randomTask = specialTasks[secureRandomInt(0, specialTasks.length - 1)];
                
                taskContent.innerHTML = `
                    <h4 class="text-lg font-bold mb-2">ç”œèœœæ—¶åˆ»ï¼</h4>
                    <p class="text-base">${randomTask}</p>
                    <p class="text-sm mt-2 opacity-80">å®Œæˆä»»åŠ¡åç‚¹å‡»â€œå®Œæˆâ€æˆ–èƒŒæ™¯å…³é—­ç»§ç»­</p>
                `;
                
                if (taskModal && typeof taskModal.showModal === 'function') {
                    taskModal.showModal();
                }
            }
        }

        // é‡ç½®æ¸¸æˆ
        function resetGame() {
            gameState = {
                player1Pos: 0,
                player2Pos: 0,
                currentPlayer: 1,
                round: 1,
                isRolling: false,
                gameOver: false,
                isMoving: false,
                fastForwardRequested: false
            };
            
            const taskModal = document.getElementById('taskModal');
            if (taskModal && taskModal.open) taskModal.close();
            const diceModal = document.getElementById('diceModal');
            if (diceModal && diceModal.open) diceModal.close();
            updateBoard();

            const modalDiceValue = document.getElementById('modalDiceValue');
            if (modalDiceValue) modalDiceValue.textContent = 'ğŸ²';
        }

        // æ˜¾ç¤ºèƒœåˆ©å¼¹çª—
        function showWinModal(winner) {
            const winModal = document.getElementById('winModal');
            const winText = document.getElementById('winText');
            if (winText) winText.textContent = `æ­å–œï¼${winner}è·èƒœï¼ğŸ‰`;
            if (winModal && typeof winModal.showModal === 'function') {
                winModal.showModal();
            }
        }

        // åˆå§‹åŒ–æ¸¸æˆ
        initBoard();
        // ä»»åŠ¡å¼¹çª—å…³é—­æŒ‰é’®
        const taskCloseBtn = document.getElementById('taskCloseBtn');
        const taskModalEl = document.getElementById('taskModal');
        if (taskCloseBtn && taskModalEl) {
            taskCloseBtn.addEventListener('click', () => {
                taskModalEl.close();
            });
        }
        // èƒœåˆ©å¼¹çª—é‡æ–°å¼€å§‹
        const winRestartBtn = document.getElementById('winRestartBtn');
        const winModalEl = document.getElementById('winModal');
        if (winRestartBtn && winModalEl) {
            winRestartBtn.addEventListener('click', () => {
                winModalEl.close();
                resetGame();
            });
        }
        // ç‚¹å‡»çŠ¶æ€ä¸­å¿ƒä¹Ÿå¯è§¦å‘æ‘‡éª°ï¼ˆä¿è¯äº‹ä»¶ç»‘å®šå­˜åœ¨ï¼‰
        const statusCenter = document.getElementById('statusCenter');
        if (statusCenter) {
            statusCenter.addEventListener('click', triggerDice);
        }
    </script>
</body>
</html>